<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Simulation interactive des points d'√©clairement</title>

 <!-- CSS -->
<link rel="stylesheet" href="style.css">

<!-- Manifest + Icone PWA -->
<link rel="manifest" href="manifest.json">
<link rel="icon" href="icons/icon-192.png">
<meta name="theme-color" content="#000000">

<!-- Menu JS -->
<script src="menu.js" defer></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            line-height: 1.5;
        }
        h1 { font-size: 1.4rem; margin-bottom: 0.5rem; }
        .bloc {
            border: 1px solid #ccc;
            padding: 15px;
            margin-top: 15px;
            border-radius: 6px;
        }
        label { display: block; margin: 6px 0 2px; }
        input[type="number"] { width: 120px; padding: 4px; }
        button { margin-top: 10px; padding: 8px 14px; cursor: pointer; }
        .schema { border: 1px solid #ccc; margin-top: 15px; padding: 10px; }
        svg text { font-size: 11px; }
    </style>
</head>
<body>

<h1>Simulation interactive des voies et points de mesures</h1>

<div class="bloc">
    <h2>Donn√©es d'entr√©e</h2>

    <label for="e">√âcartement entre luminaires e (m)</label>
    <input type="number" id="e" min="0" step="0.01" value="25">

    <label for="L">Largeur d'une voie l (m)</label>
    <input type="number" id="L" min="0" step="0.01" value="3.5">

    <label for="nbVoies">Nombre de voies</label>
    <input type="number" id="nbVoies" min="1" step="1" value="2">

    <button type="button" onclick="calculer()">Calculer et afficher</button>
</div>

<!-- üîµ IMAGE INTERACTIVE EN PREMIER -->
<div class="bloc schema">
    <h2>Image interactive des voies et points de mesures</h2>
    <p>Les rectangles repr√©sentent les voies. Les cercles repr√©sentent les points de mesures.</p>
    <svg id="schemaSvg" width="960" height="400"></svg>
</div>

<!-- üîµ R√âSULTATS NUM√âRIQUES APR√àS L‚ÄôIMAGE -->
<div class="bloc resultats">
    <h2>R√©sultats num√©riques</h2>

    <h3>Longitudinal (entre deux luminaires)</h3>
    <p id="regleLong"></p>
    <p id="pointsLong"></p>
    <p id="espacementD"></p>
    <p id="bordsD"></p>

    <h3>Transversal (par voie)</h3>
    <p id="lignesVoie"></p>
    <p id="espacementd"></p>
    <p id="bordsd"></p>

    <h3>Multiples voies</h3>
    <p id="nbVoiesTexte"></p>
    <p id="lignesTotal"></p>

    <h3>Totaux</h3>
    <p id="totalParVoie"></p>
    <p id="totalToutesVoies"></p>
</div>

<script>
function arrondir(valeur, decimales) {
    const facteur = Math.pow(10, decimales);
    return Math.round(valeur * facteur) / facteur;
}

function calculer() {
    const e = parseFloat(document.getElementById('e').value);
    const L = parseFloat(document.getElementById('L').value);
    const nbVoies = parseInt(document.getElementById('nbVoies').value, 10);

    if (isNaN(e) || e <= 0 || isNaN(L) || L <= 0 || isNaN(nbVoies) || nbVoies <= 0) {
        alert("Merci d'entrer des valeurs strictement positives pour e, l et le nombre de voies.");
        return;
    }

    // ----- CALCUL LONGITUDINAL -----
    let nPointsLong;
    let D;
    let texteRegle;

    if (e <= 30) {
        nPointsLong = 10;
        D = e / (nPointsLong - 1);
        texteRegle = "e ‚â§ 30 m ‚Üí grille avec 10 points de mesure.";
    } else {
        let nIntervalles = Math.ceil(e / 3);
        nPointsLong = nIntervalles + 1;
        D = e / nIntervalles;
        texteRegle = "e > 30 m ‚Üí nombre de points = √©cartement / 3.";
    }

    const Dbord = D / 2;

    // ----- CALCUL TRANSVERSAL -----
    let nLignesVoie = 3;
    let d = L / nLignesVoie;

    if (d > 1.5) {
        nLignesVoie = 4;
        d = L / nLignesVoie;
    }

    const dbord = d / 2;

    const nLignesTotal = nLignesVoie * nbVoies;
    const totalParVoie = nPointsLong * nLignesVoie;
    const totalToutesVoies = nPointsLong * nLignesTotal;

    // ----- AFFICHAGE -----
    document.getElementById('regleLong').textContent = texteRegle;
    document.getElementById('pointsLong').textContent = "Points longitudinaux : " + nPointsLong;
    document.getElementById('espacementD').textContent = "Espacement longitudinal D : " + arrondir(D,2) + " m";
    document.getElementById('bordsD').textContent = "Distance au bord (D/2) : " + arrondir(Dbord,2) + " m";

    document.getElementById('lignesVoie').textContent = "Lignes transversales par voie : " + nLignesVoie;
    document.getElementById('espacementd').textContent = "Espacement d : " + arrondir(d,2) + " m";
    document.getElementById('bordsd').textContent = "Distance au bord (d/2) : " + arrondir(dbord,2) + " m";

    document.getElementById('nbVoiesTexte').textContent = "Nombre de voies : " + nbVoies;
    document.getElementById('lignesTotal').textContent = "Lignes totales : " + nLignesTotal;

    document.getElementById('totalParVoie').textContent = "Total par voie : " + totalParVoie;
    document.getElementById('totalToutesVoies').textContent = "Total toutes voies : " + totalToutesVoies;

    // ----- DESSIN INTERACTIF -----
    dessinerSchema(nPointsLong, nLignesVoie, nbVoies);
}

function dessinerSchema(nPointsLong, nLignesVoie, nbVoies) {
    const svg = document.getElementById('schemaSvg');
    while (svg.firstChild) svg.removeChild(svg.firstChild);

    const width = svg.clientWidth || 960;
    const laneHeight = 50;
    const laneSpacing = 20;
    const marginTop = 40;
    const marginSide = 60;

    const totalHeight = marginTop + nbVoies * laneHeight + (nbVoies-1)*laneSpacing + 40;
    svg.setAttribute("height", totalHeight);

    const innerWidth = width - 2 * marginSide;
    const dx = innerWidth / (nPointsLong - 1);

    // --- Luminaires ---
    cr√©erCercle(svg, marginSide, 20, 8, "white", "Luminaire 1");
    cr√©erCercle(svg, marginSide + innerWidth, 20, 8, "white", "Luminaire 2");

    // --- Fl√®che ---
    cr√©erLigne(svg, marginSide + 15, 20, marginSide + innerWidth - 15, 20);
    cr√©erTexte(svg, width/2, 10, "√âcartement e");

    // --- Voies + Points ---
    for (let v = 0; v < nbVoies; v++) {
        const top = marginTop + v * (laneHeight + laneSpacing);

        cr√©erRect(svg, marginSide, top, innerWidth, laneHeight);
        cr√©erTexte(svg, width/2, top + laneHeight/2 + 4, "Voie " + (v+1));

        for (let i = 0; i < nPointsLong; i++) {
            const x = marginSide + i * dx;

            for (let l = 0; l < nLignesVoie; l++) {
                const y = top + laneHeight * ((l + 0.5) / nLignesVoie);

                const c = cr√©erCercle(svg, x, y, 4, "#0074D9",
                    `Voie ${v+1} ‚Ä¢ Ligne ${l+1} ‚Ä¢ Point ${i+1}`);

                c.addEventListener("click", () => {
                    c.setAttribute("fill", c.getAttribute("fill") === "#0074D9" ? "#FF4136" : "#0074D9");
                });
            }
        }
    }
}

function cr√©erRect(svg, x,y,w,h) {
    const r = document.createElementNS("http://www.w3.org/2000/svg", "rect");
    r.setAttribute("x",x); r.setAttribute("y",y);
    r.setAttribute("width",w); r.setAttribute("height",h);
    r.setAttribute("fill","white");
    r.setAttribute("stroke","black");
    svg.appendChild(r);
}

function cr√©erCercle(svg, cx,cy,r,fill,title) {
    const c = document.createElementNS("http://www.w3.org/2000/svg","circle");
    c.setAttribute("cx",cx); c.setAttribute("cy",cy);
    c.setAttribute("r",r); c.setAttribute("fill",fill);
    c.setAttribute("stroke","black");

    const t = document.createElementNS("http://www.w3.org/2000/svg", "title");
    t.textContent = title;
    c.appendChild(t);

    svg.appendChild(c);
    return c;
}

function cr√©erLigne(svg, x1,y1,x2,y2) {
    const l = document.createElementNS("http://www.w3.org/2000/svg","line");
    l.setAttribute("x1",x1); l.setAttribute("y1",y1);
    l.setAttribute("x2",x2); l.setAttribute("y2",y2);
    l.setAttribute("stroke","black");
    svg.appendChild(l);
}

function cr√©erTexte(svg, x,y,texte) {
    const t = document.createElementNS("http://www.w3.org/2000/svg","text");
    t.setAttribute("x",x);
    t.setAttribute("y",y);
    t.setAttribute("text-anchor","middle");
    t.textContent = texte;
    svg.appendChild(t);
}

// Affichage initial
window.addEventListener("load", calculer);
</script>

</body>
</html>


